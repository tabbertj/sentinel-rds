import "tfplan" as plan
import "strings" as strings

# Get all datastore clusters
resources = plan.find_resources("aws_db_instance")

# Filter to datastore clusters that do not enable storage DRS
# Warnings will be printed for all violations since the last parameter is true
resources = plan.filter_attribute_is_not_value(
                              resources, "publicly_accessible", true, true)

# Main rule
validated = length(resources["messages"]) is 0

main = rule {
  validated
}

 
